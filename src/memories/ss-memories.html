<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="cssgram.html">
<link rel="import" href="ss-photo-filters.html">


<dom-module id="ss-memories">
    <template>
        <style include="app-grid-style shared-styles cssgram-styles">
            
            :host {
                display: block;
                padding: 10px;
            }

            #photo {
                max-width: 90%;
            }


        </style>

        <div class="card">

            <h1>Basic Memories</h1>

            <figure class$="[[filterName]]">
                <img id="photo" src="[[selfieUrl]]" on-click="toggleFullScreenPhoto">
            </figure>

            <paper-button raised class="indigo" on-click="takePhoto">
                Take Photo
            </paper-button>

            <paper-button raised class="green" on-click="toggleFilters">
                    Filter
            </paper-button>

            <div style="display: none;">
                <input id="photoInput" type="file" accept="image/*" capture
                            on-change="uploadPhoto">
            </div>

            <template is="dom-if" if="[[showFilters]]">

                    <ss-photo-filters image-data='[[selfieUrl]]'
                                        selected-filter='{{filterName}}'>
                    </ss-photo-filters>
    
            </template>


        </div>
    </template>

    <script>
        class Memories extends Polymer.Element {
            static get is() {
                return 'ss-memories';
            }

            static get properties() {
                return {
                    showFilters: Boolean,
                    filterName: {
                        type: String,
                        value: '',
                        notify: true
                    },
                    selfieUrl: {
                        type: Object,
                        value: '../../images/avatar-placeholder.svg'
                    }
                };
            }

            ready() {
                super.ready();
            }

            takePhoto() {
                this.$.photoInput.click();
            }
            
            uploadPhoto(evt) {
                var files = Array.from(evt.target.files);
                if (files && files.length) {
                    var file = files[0];
                    var selfieUrl = URL.createObjectURL(file);
                    this.$.photo.src = selfieUrl;
                    this.set('selfieUrl', selfieUrl);
                }

            }

            toggleFilters() {
                var showFilters = this.get('showFilters');
                this.set('showFilters', !showFilters);
            }

            toggleFullScreenPhoto() {

                var img = this.$.photo;

                img.requestFullScreen = img.requestFullScreen ||
                        img.webkitRequestFullScreen ||
                        img.mozRequestFullScreen;

                if (img.requestFullScreen) {
                    img.requestFullScreen();
                } else {
                    alert('Fullscreen mode not supported');
                }
            }
        }

        window.customElements.define(Memories.is, Memories);
    </script>
</dom-module>